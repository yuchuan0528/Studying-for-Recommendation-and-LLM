2025/10/11

# 重排

## 重排1：物品相似性的度量、提升多样性的方法
如果曝光给用户的物品两两之间不相似，说明具有多样性

* **相似性的度量**：基于物品的属性标签，或者物品向量表征。
* 1. 基于物品属性：物品的属性标签一般是由CV NLP算法由内容推断得到的。
* 2. 基于物品向量表征：如果将双塔模型学习到的表征用在多样性问题中，效果不好：因为推荐系统的头部现象严重，双塔模型学习不好向量表征，处理不好新物品、长尾物品。 --> 更好的是基于图文内容的物品表征。
  ![alt text](images/image-180.png)![alt text](images/image-181.png)![alt text](images/image-182.png)![alt text](images/image-183.png)
3. 基于图文内容的物品表征：存在的问题：如何与训练CV NLP模型 --> 采用CLIP与训练
   ![alt text](images/image-184.png)

* **提升多样性的方法**
  在粗排与精排后添加后处理，采用多样性算法，既要选择得分高的物品，也需要有多样性。其中，精排的后处理也称为重排。
  ![alt text](images/image-185.png)![alt text](images/image-186.png)![alt text](images/image-187.png)

## 重排2：MMR 多样性算法（Maximal Marginal Relevance）

* **多样性**：需要基于得分reward与不同物品间的相似性sim，决定物品最终的曝光顺序
![alt text](images/image-188.png)

* **MMR多样性算法**：给未选中的物品打分（考虑reward和相似性），每一轮需要对未选中的所有物品重新打分，从中选择得分最高的，将其加入选入的集合。
  ![alt text](images/image-190.png)![alt text](images/image-191.png)

* **滑动窗口**：由于在计算MMR得分时，用到物品i与所有已选中物品j的相似度。当j很多时，难以找到都不相似的物品。 --> 用滑动窗口代表所有已选中的物品，每次只看与最近选中的10个物品的相似性。

即没有必要让物品与第30个物品都不相似，可能只需要与最近的10个不相似
  ![alt text](images/image-192.png)![alt text](images/image-193.png)

## 重排3：业务规则约束下的多样性算法

* **重排的规则** 规则优于多样性算法
  ![alt text](images/image-194.png)![alt text](images/image-195.png)![alt text](images/image-196.png)

* **MMR + 重排规则**：在用MMR选物品前，先用规则排除一部分物品（从删除后的子集选择物品）
  ![alt text](images/image-198.png)

## 重排4：DPP 多样性算法（上）
行列式点过程 (determinantal point process, DPP) 是一种经典的机器学习方法，DPP 是目前推荐系统重排多样性公认的最好方法。
* **数学基础之超平行体**
  ![alt text](images/image-199.png)![alt text](images/image-200.png)

  超平行体定义：要求确定超平行体的向量线性无关
  ![alt text](images/image-201.png)![alt text](images/image-203.png)![alt text](images/image-204.png)![alt text](images/image-205.png)

   --> 衡量物品的多样性：利用体积最大化，用矩阵表示的话，体积就是行列式的值，可以用行列式衡量物品多样性
   ![alt text](images/image-206.png)![alt text](images/image-208.png)

## 重排5：DPP 多样性算法（下）

* 回顾：多样性问题
![alt text](images/image-209.png)

* **DPP基本思想**：用行列式衡量物体多样性 --> 主要贡献：如何快速求解（难点在于计算行列式）？使用贪心算法，每一轮选择物品$i$，希望添加的物品$i$能让$A$的行列式尽可能大（物品i不能和物品中任何物品相似）
  ![alt text](images/image-210.png)![alt text](images/image-211.png)![alt text](images/image-212.png)

* **求解DPP**：使用贪心算法暴力求解总时间复杂度高。其中求解矩阵$A$的复杂度是$O(n^2d)$，求解行列式的复杂度是$O(NK^4)$
 ![alt text](images/image-213.png)![alt text](images/image-214.png)
* hulu 的快速算法：利用了矩阵的Cholesky分解，避免了行列式的大部分计算。若已知$A_s$的Cholesky分解，那么当给定新的行列时，不需要重新计算分解，可以快速计算有变换的地方，快速计算行列式。
  ![alt text](images/image-215.png)![alt text](images/image-216.png)![alt text](images/image-217.png)

* **DPP的扩展**
* 1. 滑动窗口用于DPP：与MMR中的滑动窗口类似，只计算未选中物品与最近选中的一部分物品（滑动窗口）中的相似性。
  ![alt text](images/image-218.png)![alt text](images/image-219.png)
* 2. 规则约束：算法只能选择满足规则的物品，因此先利用规则删除不符合规则的物品，再进行求解。
  ![alt text](images/image-220.png)